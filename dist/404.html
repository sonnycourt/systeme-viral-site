<!DOCTYPE html><html lang="fr"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="shortcut icon" href="/favicon.ico"><meta name="generator" content="Astro v5.13.4"><title>Page non trouvée - Système Viral</title><!-- SEO Meta Tags --><meta name="description" content="La page que vous cherchez n'existe pas. Découvrez comment créer du contenu viral et générer des revenus avec le Système Viral."><meta name="robots" content="index, follow"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://systemeviral.com/404"><meta property="og:title" content="Page non trouvée - Système Viral | Système Viral"><meta property="og:description" content="La page que vous cherchez n'existe pas. Découvrez comment créer du contenu viral et générer des revenus avec le Système Viral."><meta property="og:image" content="https://systemeviral.com/og-image.jpg"><meta property="og:site_name" content="Système Viral"><meta property="og:locale" content="fr_FR"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://systemeviral.com/404"><meta property="twitter:title" content="Page non trouvée - Système Viral | Système Viral"><meta property="twitter:description" content="La page que vous cherchez n'existe pas. Découvrez comment créer du contenu viral et générer des revenus avec le Système Viral."><meta property="twitter:image" content="https://systemeviral.com/og-image.jpg"><!-- Canonical URL --><link rel="canonical" href="https://systemeviral.com/404"><!-- Additional Meta Tags --><meta name="author" content="Système Viral"><meta name="keywords" content="marketing digital, formation entrepreneur, croissance entreprise, stratégie business, système viral"><meta name="language" content="fr"><meta name="revisit-after" content="7 days"><!-- Schema.org structured data --><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"Système Viral","url":"https://systemeviral.com","logo":"https://systemeviral.com/logo.png","description":"La page que vous cherchez n'existe pas. Découvrez comment créer du contenu viral et générer des revenus avec le Système Viral.","address":{"@type":"PostalAddress","addressCountry":"FR"},"contactPoint":{"@type":"ContactPoint","contactType":"customer service","email":"support@systemeviral.com"},"sameAs":["https://linkedin.com/company/systemeviral","https://youtube.com/@systemeviral"]}</script><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:title" content="Page non trouvée - Système Viral"><meta property="og:description" content="La page que vous cherchez n'existe pas. Découvrez comment créer du contenu viral et générer des revenus avec le Système Viral."><meta property="og:image" content="https://systemeviral.com/og-image.jpg"><meta property="og:image:secure_url" content="https://systemeviral.com/og-image.jpg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image:type" content="image/webp"><meta property="og:url" content="https://systemeviral.com/404/"><meta property="og:site_name" content="Système Viral"><meta property="og:locale" content="fr_FR"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Page non trouvée - Système Viral"><meta name="twitter:description" content="La page que vous cherchez n'existe pas. Découvrez comment créer du contenu viral et générer des revenus avec le Système Viral."><meta name="twitter:image" content="https://systemeviral.com/og-image.jpg"><meta name="twitter:image:alt" content="Page non trouvée - Système Viral"><!-- Meta Pixel Code --><script src="/meta-pixel.js" defer></script><noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=812946297991293&ev=PageView&noscript=1"></noscript><!-- End Meta Pixel Code --><!-- UTM Tracker - Capture les paramètres UTM pour MailerLite --><script src="/scripts/utm-tracker.js"></script><style>:root{--bg: #0a0a0a;--bg-card: rgba(255, 255, 255, .02);--bg-elevated: rgba(255, 255, 255, .05);--text: #ffffff;--text-secondary: #aaa;--text-muted: #888;--accent: #00dc82;--accent-bright: #00f593;--accent-glow: #00dc82;--accent-dark: #00b86b;--success: #00dc82;--border: rgba(255, 255, 255, .1);--glow: rgba(0, 220, 130, .3);--danger: #ef4444}.gradient-bg[data-astro-cid-zetdm5md]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0a0a0a;z-index:-1}.gradient-bg[data-astro-cid-zetdm5md]:before{content:"";position:absolute;top:0;left:50%;transform:translate(-50%);width:800px;height:600px;background:radial-gradient(circle,rgba(0,220,130,.08) 0%,transparent 70%);pointer-events:none;animation:bgGlow 6s ease-in-out infinite}@keyframes bgGlow{0%,to{opacity:.3;transform:translate(-50%) scale(1)}50%{opacity:.6;transform:translate(-50%) scale(1.2)}}.error-section[data-astro-cid-zetdm5md]{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:40px 20px;position:relative;overflow:hidden}.container[data-astro-cid-zetdm5md]{max-width:1200px;width:100%;position:relative;z-index:1}.error-content[data-astro-cid-zetdm5md]{text-align:center;max-width:700px;margin:0 auto}.error-code[data-astro-cid-zetdm5md]{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:40px}.code-main[data-astro-cid-zetdm5md]{font-size:clamp(80px,15vw,150px);font-weight:900;background:linear-gradient(135deg,var(--accent) 0%,var(--accent-bright) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 0 60px rgba(0,220,130,.5);animation:codePulse 3s ease-in-out infinite;line-height:1}.code-zero[data-astro-cid-zetdm5md]{font-size:clamp(80px,15vw,150px);font-weight:900;color:var(--text-secondary);animation:zeroRotate 4s ease-in-out infinite;line-height:1}@keyframes codePulse{0%,to{transform:scale(1);text-shadow:0 0 60px rgba(0,220,130,.5)}50%{transform:scale(1.05);text-shadow:0 0 80px rgba(0,220,130,.8)}}@keyframes zeroRotate{0%,to{transform:rotate(0)}25%{transform:rotate(90deg)}50%{transform:rotate(180deg)}75%{transform:rotate(270deg)}}.error-title[data-astro-cid-zetdm5md]{font-size:clamp(24px,4vw,36px);font-weight:700;color:var(--text);margin-bottom:24px;line-height:1.3}.error-description[data-astro-cid-zetdm5md]{font-size:18px;color:var(--text-secondary);line-height:1.6;margin-bottom:20px;max-width:500px;margin-left:auto;margin-right:auto}.error-actions[data-astro-cid-zetdm5md]{display:flex;justify-content:center;margin-top:40px}.cta-button[data-astro-cid-zetdm5md]{display:inline-block;padding:16px 32px;background:var(--accent);color:var(--bg);text-decoration:none;font-weight:600;font-size:16px;border-radius:8px;transition:all .2s ease;border:none;cursor:pointer}.cta-button[data-astro-cid-zetdm5md]:hover{background:var(--accent-bright);transform:translateY(-1px)}@media (max-width: 768px){.error-section[data-astro-cid-zetdm5md]{padding:20px 16px}.error-code[data-astro-cid-zetdm5md]{margin-bottom:30px}.code-main[data-astro-cid-zetdm5md],.code-zero[data-astro-cid-zetdm5md]{font-size:clamp(60px,20vw,100px)}.error-title[data-astro-cid-zetdm5md]{font-size:24px}.error-description[data-astro-cid-zetdm5md]{font-size:16px}.cta-button[data-astro-cid-zetdm5md]{padding:14px 28px;font-size:15px}}
</style>
<link rel="stylesheet" href="/_assets/100k-felicitations.Bmg39hn7.css"></head> <body> <div id="password-protection" class="password-protection hidden" data-astro-cid-732embm3> <div class="password-overlay" data-astro-cid-732embm3> <div class="password-modal" data-astro-cid-732embm3> <h2 class="password-title" data-astro-cid-732embm3>Accès Protégé</h2> <p class="password-subtitle" data-astro-cid-732embm3>Veuillez entrer le mot de passe pour accéder au site</p> <form id="password-form" class="password-form" data-astro-cid-732embm3> <input type="password" id="password-input" class="password-input" placeholder="Mot de passe" autocomplete="off" autofocus data-astro-cid-732embm3> <button type="submit" class="password-submit" data-astro-cid-732embm3>Accéder</button> </form> <div id="password-error" class="password-error hidden" data-astro-cid-732embm3>
Mot de passe incorrect
</div> </div> </div> </div> <script type="module">!function(){const e="sv_password_authenticated";function t(){const e=document.getElementById("password-protection"),t=document.querySelector("main");e&&(e.classList.add("hidden"),t&&(t.style.display=""))}function n(n){n.preventDefault();const o=document.getElementById("password-input"),s=document.getElementById("password-error"),d=o?.value;"systemeviral2025"===d?(!function(){const t={authenticated:!0,timestamp:Date.now(),expires:Date.now()+864e5};localStorage.setItem(e,JSON.stringify(t))}(),t(),s&&s.classList.add("hidden")):(s&&s.classList.remove("hidden"),o&&(o.value="",o.focus()))}document.addEventListener("DOMContentLoaded",(function(){const o=document.getElementById("password-form");o&&o.addEventListener("submit",n),function(){const t=localStorage.getItem(e);if(!t)return!1;try{const n=JSON.parse(t),o=Date.now();return!(n.expires&&n.expires<o&&(localStorage.removeItem(e),1))}catch(n){return!1}}()?t():function(){const e=document.getElementById("password-protection"),t=document.querySelector("main");e&&(e.classList.remove("hidden"),t&&(t.style.display="none"))}()}))}();</script>  <script>(function(){
  var GA_MEASUREMENT_ID = "G-EN1Y8Y7QLM";
  if(!GA_MEASUREMENT_ID || GA_MEASUREMENT_ID === "G-XXXXXXXXXX"){
    // Désactiver GA si pas d'ID valide
    window.dataLayer = window.dataLayer || [];
    window.gtag = function(){ window.dataLayer.push(arguments); };
    window.__consent = { accept:function(){}, refuse:function(){} };
    return;
  }

  window.dataLayer = window.dataLayer || [];
  function gtag(){ window.dataLayer.push(arguments); }
  window.gtag = gtag;

  gtag('consent','default',{
    ad_storage:'denied',
    analytics_storage:'denied',
    ad_user_data:'denied',
    ad_personalization:'denied'
  });

  var s=document.createElement('script');
  s.async=true;
  s.src='https://www.googletagmanager.com/gtag/js?id='+GA_MEASUREMENT_ID;
  document.head.appendChild(s);
  s.onload=function(){
    gtag('js', new Date());
    gtag('config', GA_MEASUREMENT_ID, { anonymize_ip: true });
  };

  window.__consent={
    accept:function(){
      gtag('consent','update',{
        ad_storage:'granted',
        analytics_storage:'granted',
        ad_user_data:'granted',
        ad_personalization:'granted'
      });
      gtag('event','cookie_accept');
      // Forcer un page_view immédiat pour déclencher un hit dès l'acceptation
      try {
        gtag('event','page_view', {
          page_title: document.title,
          page_location: window.location.href,
          page_path: window.location.pathname
        });
      } catch (_) {}
    },
    refuse:function(){
      gtag('event','cookie_refuse');
    }
  };
})();</script> <main>   <div class="gradient-bg" data-astro-cid-zetdm5md></div>  <section class="error-section" data-astro-cid-zetdm5md> <div class="container" data-astro-cid-zetdm5md> <div class="error-content" data-astro-cid-zetdm5md> <div class="error-code" data-astro-cid-zetdm5md> <span class="code-main" data-astro-cid-zetdm5md>4</span> <span class="code-zero" data-astro-cid-zetdm5md>0</span> <span class="code-main" data-astro-cid-zetdm5md>4</span> </div> <h1 class="error-title" data-astro-cid-zetdm5md>Page introuvable</h1> <p class="error-description" data-astro-cid-zetdm5md>
Désolé, la page que vous cherchez n'existe pas.
</p> <div class="error-actions" data-astro-cid-zetdm5md> <a href="/" class="cta-button" data-astro-cid-zetdm5md> Retour à l'accueil </a> </div> </div> </div> </section>  </main> <style is:global>/*
  Styles Cookie Consent pour Système Viral — adaptés au thème (vert #00DC82, surfaces sombres, arrondis, ombres)
  Léger, responsive, accessible.
*/

:root {
  --cc-surface: rgba(28, 28, 30, 0.98);
  --cc-border: rgba(255, 255, 255, 0.1);
  --cc-text: #C7C7CC;
  --cc-text-strong: #FFFFFF;
  --cc-muted: #8E8E93;
  --cc-primary: #00DC82;
  --cc-primary-dark: #00B870;
}

.cookie-banner {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 20px;
  z-index: 2000;
  display: grid;
  place-items: center;
  padding: 0 20px;
}

/* Empêcher tout flash quand l'attribut hidden est présent */
.cookie-banner[hidden] {
  display: none !important;
}

.cookie-banner__content {
  width: 100%;
  max-width: 1100px;
  background: var(--cc-surface);
  border: 1px solid var(--cc-border);
  border-radius: 16px;
  padding: 18px 20px;
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 16px;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
  backdrop-filter: blur(16px) saturate(160%);
}

.cookie-banner__text {
  display: flex;
  align-items: center;
  gap: 14px;
}

.cookie-title {
  margin: 0;
  color: var(--cc-text-strong);
  font-size: 16px;
  font-weight: 700;
  letter-spacing: -0.01em;
}

.cookie-desc {
  margin: 0;
  color: var(--cc-muted);
  font-size: 14px;
}

.cookie-link {
  color: var(--cc-text);
  text-decoration: none;
  border-bottom: 1px dashed var(--cc-border);
  font-size: 12px;
}

.cookie-link:hover { color: var(--cc-text-strong); }

.cookie-banner__actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.cookie-btn {
  font-family: inherit;
  border-radius: 999px;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid transparent;
  white-space: nowrap;
}

.cookie-btn--primary {
  background: linear-gradient(135deg, var(--cc-primary) 0%, var(--cc-primary-dark) 50%, var(--cc-primary) 100%);
  background-size: 200% 200%;
  color: #000000;
  font-weight: 700;
  font-size: 14px;
  padding: 12px 22px;
  box-shadow: 0 12px 30px rgba(0, 220, 130, 0.35), inset 0 0 0 2px rgba(255, 255, 255, 0.08);
}

.cookie-btn--primary:hover { 
  transform: translateY(-1px) scale(1.02); 
  background-position: 100% 100%;
  box-shadow: 0 18px 40px rgba(0, 220, 130, 0.5), inset 0 0 0 2px rgba(255, 255, 255, 0.2);
}

.cookie-btn--ghost {
  background: rgba(255, 255, 255, 0.05);
  color: var(--cc-text);
  font-weight: 500;
  font-size: 14px;
  padding: 10px 16px;
  border: 1px solid var(--cc-border);
}

.cookie-btn--ghost:hover { color: #fff; background: rgba(255,255,255,0.1); }

.cookie-btn--primary-outline {
  background: transparent;
  border: 1px solid var(--cc-primary);
  color: var(--cc-text-strong);
  font-weight: 600;
  padding: 10px 16px;
}

/* Modal */
.cookie-modal { position: fixed; inset: 0; z-index: 2100; display: grid; place-items: center; }
.cookie-modal[hidden] { display: none; }

.cookie-modal__overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); }

.cookie-modal__panel {
  position: relative;
  width: min(600px, calc(100% - 32px));
  background: var(--cc-surface);
  border: 1px solid var(--cc-border);
  border-radius: 16px;
  box-shadow: 0 30px 80px rgba(0,0,0,0.5);
  overflow: hidden;
}

.cookie-modal__header { display: flex; justify-content: space-between; align-items: center; padding: 16px 18px; border-bottom: 1px solid var(--cc-border); }

.cookie-modal__body { padding: 10px 18px 6px; display: grid; gap: 14px; }

.cookie-category { display: flex; align-items: center; justify-content: space-between; padding: 14px; border: 1px solid var(--cc-border); border-radius: 12px; background: rgba(255,255,255,0.03); }
.cookie-category__text h4 { margin: 0 0 4px 0; color: var(--cc-text-strong); font-size: 15px; }
.cookie-category__text p { margin: 0; color: var(--cc-muted); font-size: 13px; }

.cookie-modal__footer { display: flex; justify-content: space-between; align-items: center; gap: 10px; padding: 12px 18px 16px; border-top: 1px solid var(--cc-border); }
.cookie-modal__cta { display: flex; gap: 8px; }

.cookie-close { background: transparent; border: 1px solid var(--cc-border); color: var(--cc-text); border-radius: 8px; padding: 6px 10px; cursor: pointer; }
.cookie-close:hover { color: #fff; background: rgba(255,255,255,0.08); }

/* Switch */
.switch { position: relative; display: inline-block; width: 46px; height: 26px; }
.switch input { display: none; }
.slider { position: absolute; cursor: pointer; inset: 0; background: rgba(255,255,255,0.1); border: 1px solid var(--cc-border); transition: 0.2s; border-radius: 999px; }
.slider:before { content: ""; position: absolute; height: 20px; width: 20px; left: 3px; top: 2px; background-color: #fff; transition: 0.2s; border-radius: 50%; }
input:checked + .slider { background: rgba(0,220,130,0.25); border-color: rgba(0,220,130,0.45); }
input:checked + .slider:before { transform: translateX(20px); box-shadow: 0 0 0 3px rgba(0,220,130,0.15); }
input:disabled + .slider { opacity: 0.6; cursor: not-allowed; }

/* Responsive */
@media (max-width: 768px) {
  .cookie-banner {
    bottom: 16px;
    padding: 0 16px;
  }
  
  .cookie-banner__content { 
    grid-template-columns: 1fr; 
    gap: 16px; 
    padding: 20px 18px;
    border-radius: 20px;
  }
  
  .cookie-banner__text { 
    align-items: flex-start; 
    flex-direction: column; 
    gap: 12px;
  }
  
  .cookie-title {
    font-size: 18px;
    line-height: 1.3;
  }
  
  .cookie-desc {
    font-size: 15px;
    line-height: 1.4;
  }
  
  .cookie-link {
    font-size: 13px;
    align-self: flex-start;
  }
  
  .cookie-banner__actions { 
    justify-content: stretch; 
    flex-direction: column;
    gap: 12px;
  }
  
  .cookie-btn--primary { 
    padding: 16px 24px; 
    font-size: 16px; 
    width: 100%;
    justify-content: center;
  }
  
  .cookie-btn--ghost {
    padding: 14px 20px;
    font-size: 15px;
    width: 100%;
    justify-content: center;
  }
  
  /* Modal mobile */
  .cookie-modal__panel {
    width: calc(100% - 24px);
    margin: 16px;
    max-height: calc(100vh - 32px);
    overflow-y: auto;
  }
  
  .cookie-modal__header {
    padding: 18px 20px;
  }
  
  .cookie-modal__body {
    padding: 16px 20px;
    gap: 16px;
  }
  
  .cookie-category {
    padding: 16px;
  }
  
  .cookie-modal__footer {
    padding: 16px 20px 20px;
    flex-direction: column;
    gap: 16px;
  }
  
  .cookie-modal__cta {
    width: 100%;
    flex-direction: column;
  }
  
  .cookie-modal__cta .cookie-btn {
    width: 100%;
    justify-content: center;
  }
}

@media (max-width: 480px) {
  .cookie-banner {
    bottom: 12px;
    padding: 0 12px;
  }
  
  .cookie-banner__content {
    padding: 18px 16px;
    border-radius: 18px;
  }
  
  .cookie-title {
    font-size: 17px;
  }
  
  .cookie-desc {
    font-size: 14px;
  }
  
  .cookie-btn--primary {
    padding: 15px 20px;
    font-size: 15px;
  }
  
  .cookie-btn--ghost {
    padding: 13px 18px;
    font-size: 14px;
  }
  
  /* Modal très petit écran */
  .cookie-modal__panel {
    width: calc(100% - 16px);
    margin: 8px;
  }
  
  .cookie-modal__header,
  .cookie-modal__body,
  .cookie-modal__footer {
    padding-left: 16px;
    padding-right: 16px;
  }
}
</style><div class="cookie-banner" id="cookieBanner" aria-live="polite" role="dialog" aria-label="Bannière de gestion des cookies" hidden> <div class="cookie-banner__content"> <div class="cookie-banner__text"> <h3 class="cookie-title">Gestion des cookies</h3> <p class="cookie-desc">
Nous utilisons des cookies pour améliorer ton expérience,
                mesurer l'audience et adapter le contenu marketing.
</p> <a href="/confidentialite/" class="cookie-link">En savoir plus</a> </div> <div class="cookie-banner__actions"> <button class="cookie-btn cookie-btn--primary" id="acceptAllCookies">Accepter tous les cookies</button> <button class="cookie-btn cookie-btn--ghost" id="openPreferences" aria-haspopup="dialog">Gérer en détail</button> </div> </div> </div> <!-- Modale de préférences --> <div class="cookie-modal" id="cookieModal" role="dialog" aria-modal="true" aria-labelledby="cookieModalTitle" hidden> <div class="cookie-modal__overlay" id="cookieModalOverlay"></div> <div class="cookie-modal__panel" role="document"> <div class="cookie-modal__header"> <h3 id="cookieModalTitle" class="cookie-title">
Préférences des cookies
</h3> <button class="cookie-close" id="closePreferences" aria-label="Fermer">✕</button> </div> <div class="cookie-modal__body"> <div class="cookie-category"> <div class="cookie-category__text"> <h4>Nécessaires</h4> <p>
Indispensables au fonctionnement du site. Toujours
                        actifs.
</p> </div> <label class="switch"> <input type="checkbox" checked disabled> <span class="slider"></span> </label> </div> <div class="cookie-category"> <div class="cookie-category__text"> <h4>Statistiques</h4> <p>Mesure anonyme de l'audience (ex: Google Analytics).</p> </div> <label class="switch"> <input type="checkbox" id="toggleStatistics" checked> <span class="slider"></span> </label> </div> <div class="cookie-category"> <div class="cookie-category__text"> <h4>Marketing</h4> <p>Personnalisation et retargeting publicitaire.</p> </div> <label class="switch"> <input type="checkbox" id="toggleMarketing" checked> <span class="slider"></span> </label> </div> </div> <div class="cookie-modal__footer"> <button class="cookie-btn cookie-btn--ghost" id="declineNonEssential">Refuser les non-essentiels</button> <div class="cookie-modal__cta"> <button class="cookie-btn cookie-btn--primary" id="savePreferences">Enregistrer mes choix</button> <button class="cookie-btn cookie-btn--primary-outline" id="acceptAllInModal">Accepter tous</button> </div> </div> </div> </div> <script>/*
  Cookie Consent Controller pour Système Viral
  - Persiste le consentement dans un cookie `cookieConsent` (12 mois)
  - Active les scripts différés ayant `type="text/plain"` et `data-cookie-category`
  - Catégories supportées: statistics, marketing (necessary est implicite)
*/
(function () {
  function init() {
  const COOKIE_NAME = 'cookieConsent';
  const COOKIE_MAX_AGE = 60 * 60 * 24 * 365; // 12 mois en secondes

  const banner = document.getElementById('cookieBanner');
  const modal = document.getElementById('cookieModal');
  if (!banner) return;

  // Vérifier si l'utilisateur a déjà donné son consentement
  const existingConsent = getCookie(COOKIE_NAME);
  if (existingConsent) {
    try {
      const consent = parseConsent(existingConsent);
      if (consent && consent.timestamp) {
        // Appliquer le consentement existant et ne pas afficher la bannière
        applyConsent(consent);
        // Appeler les hooks Consent Mode si nécessaire
        if (consent.statistics && window.__consent && typeof window.__consent.accept === 'function') {
          window.__consent.accept();
        } else if (!consent.statistics && window.__consent && typeof window.__consent.refuse === 'function') {
          window.__consent.refuse();
        }
        // Masquer la bannière et sortir
        hideBanner();
        return; // Sortir de la fonction, ne pas afficher la bannière
      }
    } catch (e) {
      // En cas d'erreur de parsing, continuer et afficher la bannière
      console.warn('Erreur parsing consentement existant:', e);
    }
  }

  const acceptAllBtn = document.getElementById('acceptAllCookies');
  const openPrefsBtn = document.getElementById('openPreferences');
  const closePrefsBtn = document.getElementById('closePreferences');
  const modalOverlay = document.getElementById('cookieModalOverlay');
  const toggleStatistics = document.getElementById('toggleStatistics');
  const toggleMarketing = document.getElementById('toggleMarketing');
  const declineBtn = document.getElementById('declineNonEssential');
  const saveBtn = document.getElementById('savePreferences');
  const acceptAllInModalBtn = document.getElementById('acceptAllInModal');

  function setCookie(name, value, maxAgeSeconds) {
    const secure = window.location.protocol === 'https:' ? '; Secure' : '';
    document.cookie = `${name}=${encodeURIComponent(value)}; Path=/; Max-Age=${maxAgeSeconds}; SameSite=Lax${secure}`;
  }

  function getCookie(name) {
    return document.cookie
      .split('; ')
      .find((row) => row.startsWith(name + '='))
      ?.split('=')[1];
  }

  function parseConsent(value) {
    try {
      return JSON.parse(decodeURIComponent(value));
    } catch {
      return null;
    }
  }

  function storeConsent(consent) {
    setCookie(COOKIE_NAME, JSON.stringify(consent), COOKIE_MAX_AGE);
  }

  function sendAnalyticsEvent(eventName, params = {}) {
    try {
      // gtag direct (si GA4 est injecté directement)
      if (typeof window.gtag === 'function') {
        window.gtag('event', eventName, params);
        return true;
      }
      // GTM / dataLayer (si GTM est injecté)
      if (Array.isArray(window.dataLayer)) {
        window.dataLayer.push({ event: eventName, ...params });
        return true;
      }
    } catch (_) {
      // ignore
    }
    return false;
  }

  function applyConsent(consent) {
    // Débloquer les scripts différés compatibles
    const scripts = document.querySelectorAll('script[type="text/plain"][data-cookie-category]');
    scripts.forEach((script) => {
      const category = script.getAttribute('data-cookie-category');
      const allowed = category === 'necessary' || !!consent[category];
      if (allowed) {
        const el = document.createElement('script');
        // Copie des attributs utiles
        Array.from(script.attributes).forEach((attr) => {
          if (attr.name === 'type') return;
          if (attr.name === 'data-cookie-category') return;
          el.setAttribute(attr.name, attr.value);
        });
        el.type = 'text/javascript';
        if (script.textContent) el.textContent = script.textContent;
        script.replaceWith(el);
      }
    });
  }

  function showBanner() {
    banner.hidden = false;
    banner.setAttribute('aria-hidden', 'false');
    banner.style.display = '';
  }

  function hideBanner() {
    banner.hidden = true;
    banner.setAttribute('aria-hidden', 'true');
    banner.style.display = 'none';
  }

  function openModal() {
    modal.hidden = false;
    document.body.style.overflow = 'hidden';
  }

  function closeModal() {
    modal.hidden = true;
    document.body.style.overflow = '';
  }

  // Si on arrive ici, c'est qu'aucun consentement existant valide n'a été trouvé
  // On montre la bannière pour obtenir un choix
  showBanner();

  // Listeners
  if (acceptAllBtn) {
    acceptAllBtn.addEventListener('click', () => {
      const consent = { necessary: true, statistics: true, marketing: true, timestamp: Date.now() };
      storeConsent(consent);
      applyConsent(consent);
      // Consent Mode hooks
      if (window.__consent && typeof window.__consent.accept === 'function') {
        window.__consent.accept();
      }
      // Notifier GA4 (après consentement)
      // dataLayer existe dès l'init GTM, donc on peut pousser immédiatement
      sendAnalyticsEvent('cookie_accept', { method: 'accept_all' });
      hideBanner();
      closeModal();
    });
  }
  // Fallback: délégation d'événement au cas où le bouton serait recréé
  banner.addEventListener('click', (e) => {
    const target = e.target;
    if (target && target.id === 'acceptAllCookies') {
      const consent = { necessary: true, statistics: true, marketing: true, timestamp: Date.now() };
      storeConsent(consent);
      applyConsent(consent);
      sendAnalyticsEvent('cookie_accept', { method: 'accept_all_delegate' });
      hideBanner();
      closeModal();
    }
  });

  if (openPrefsBtn) openPrefsBtn.addEventListener('click', openModal);
  if (closePrefsBtn) closePrefsBtn.addEventListener('click', closeModal);
  if (modalOverlay) modalOverlay.addEventListener('click', closeModal);

  if (declineBtn) {
    declineBtn.addEventListener('click', () => {
      const consent = { necessary: true, statistics: false, marketing: false, timestamp: Date.now() };
      storeConsent(consent);
      applyConsent(consent);
      if (window.__consent && typeof window.__consent.refuse === 'function') {
        window.__consent.refuse();
      }
      // Pas de GA avant consentement: on tente uniquement si un conteneur existe déjà (ne s'enverra pas sinon)
      sendAnalyticsEvent('cookie_refuse', { method: 'decline_all' });
      hideBanner();
      closeModal();
    });
  }

  if (saveBtn) {
    saveBtn.addEventListener('click', () => {
      const consent = {
        necessary: true,
        statistics: !!(toggleStatistics && toggleStatistics.checked),
        marketing: !!(toggleMarketing && toggleMarketing.checked),
        timestamp: Date.now(),
      };
      storeConsent(consent);
      applyConsent(consent);
      if (consent.statistics) {
        window.__consent && typeof window.__consent.accept === 'function' && window.__consent.accept();
      } else {
        window.__consent && typeof window.__consent.refuse === 'function' && window.__consent.refuse();
      }
      // Evénements selon la case Statistiques
      if (consent.statistics) {
        sendAnalyticsEvent('cookie_accept', { method: 'preferences' });
      } else {
        sendAnalyticsEvent('cookie_refuse', { method: 'preferences' });
      }
      hideBanner();
      closeModal();
    });
  }

  if (acceptAllInModalBtn) {
    acceptAllInModalBtn.addEventListener('click', () => {
      const consent = { necessary: true, statistics: true, marketing: true, timestamp: Date.now() };
      storeConsent(consent);
      applyConsent(consent);
      if (window.__consent && typeof window.__consent.accept === 'function') {
        window.__consent.accept();
      }
      sendAnalyticsEvent('cookie_accept', { method: 'accept_all_modal' });
      hideBanner();
      closeModal();
    });
  }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script> </body></html> 