<!DOCTYPE html><html data-astro-cid-3nssi2tu lang=fr><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Dashboard - Syst√®me Viral</title><link href=/favicon.ico rel=icon type=image/x-icon><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel=stylesheet><script src=/_assets/dashboard.astro_astro_type_script_index_0_lang.B9oaqmW6.js type=module></script><script src=/_assets/dashboard.astro_astro_type_script_index_1_lang.jS8I5DUp.js type=module></script><script src=/_assets/dashboard.astro_astro_type_script_index_2_lang.CptbmB8l.js type=module></script><link href=/_assets/dashboard.Bc1Hs3-x.css rel=stylesheet></head><body data-astro-cid-3nssi2tu><div data-astro-cid-3nssi2tu class=container><div data-astro-cid-3nssi2tu class=header><h1 data-astro-cid-3nssi2tu>üìä Dashboard</h1><p data-astro-cid-3nssi2tu>Suivez le parcours complet de vos leads et vos performances</p></div><div data-astro-cid-3nssi2tu class=stats id=stats><div data-astro-cid-3nssi2tu class=stat-card><h3 data-astro-cid-3nssi2tu>Total Leads</h3><div data-astro-cid-3nssi2tu class=value id=totalLeads>0</div></div><div data-astro-cid-3nssi2tu class=stat-card><h3 data-astro-cid-3nssi2tu>Optins</h3><div data-astro-cid-3nssi2tu class=value id=totalOptins>0</div></div><div data-astro-cid-3nssi2tu class=stat-card><h3 data-astro-cid-3nssi2tu>Achats</h3><div data-astro-cid-3nssi2tu class=value id=totalPurchases>0</div></div><div data-astro-cid-3nssi2tu class=stat-card><h3 data-astro-cid-3nssi2tu>Taux Conversion</h3><div data-astro-cid-3nssi2tu class=value id=conversionRate>0%</div></div></div><div data-astro-cid-3nssi2tu class=ga-section id=ga-section><h2 data-astro-cid-3nssi2tu>üìä Google Analytics</h2><div data-astro-cid-3nssi2tu class=stats id=ga-stats><div data-astro-cid-3nssi2tu class=stat-card><h3 data-astro-cid-3nssi2tu>Visiteurs (Aujourd'hui)</h3><div data-astro-cid-3nssi2tu class=value id=ga-today>-</div></div><div data-astro-cid-3nssi2tu class=stat-card><h3 data-astro-cid-3nssi2tu>Taux de Conversion</h3><div data-astro-cid-3nssi2tu class=value id=ga-conversion>-</div></div><div data-astro-cid-3nssi2tu class=stat-card><h3 data-astro-cid-3nssi2tu>Temps Session</h3><div data-astro-cid-3nssi2tu class=value id=ga-duration>-</div></div><div data-astro-cid-3nssi2tu class=stat-card><h3 data-astro-cid-3nssi2tu>En Temps R√©el</h3><div data-astro-cid-3nssi2tu class=value id=ga-realtime>-</div></div></div><div data-astro-cid-3nssi2tu id=ga-traffic-sources style=margin-top:40px><h3 data-astro-cid-3nssi2tu>üìà Sources de Trafic</h3><div data-astro-cid-3nssi2tu id=sources-container></div></div></div><div data-astro-cid-3nssi2tu id=journeys><div data-astro-cid-3nssi2tu class=loading>‚è≥ Chargement des parcours...</div></div></div><script>async function loadJourneys(){try{let e=await fetch("/api/journeys");e.ok||(e=await fetch("/.netlify/functions/get-journeys"));const t=await e.json();displayJourneys(t.journeys),updateStats(t.journeys)}catch(e){const t=document.getElementById("journeys");t&&(t.innerHTML=`\n                        <div class="error">\n                            ‚ùå Erreur lors du chargement : ${e instanceof Error?e.message:"Unknown error"}\n                            <br><br>\n                            <button class="refresh-btn" onclick="loadJourneys()">üîÑ R√©essayer</button>\n                        </div>\n                    `)}}function updateStats(e){const t=e.length,n=e.filter((e=>e.steps.some((e=>"optin"===e.action)))).length,s=e.filter((e=>e.steps.some((e=>"purchase"===e.action)))).length,o=n>0?Math.round(s/n*100):0,a=document.getElementById("totalLeads"),i=document.getElementById("totalOptins"),c=document.getElementById("totalPurchases"),r=document.getElementById("conversionRate");a&&(a.textContent=String(t)),i&&(i.textContent=String(n)),c&&(c.textContent=String(s)),r&&(r.textContent=String(o)+"%")}function displayJourneys(e){const t=document.getElementById("journeys");if(!t)return;if(0===e.length)return void(t.innerHTML='\n                    <div class="empty">\n                        üì≠ Aucun lead pour le moment.<br>\n                        Les parcours appara√Ætront ici une fois que les leads commenceront √† interagir avec le site.\n                    </div>\n                ');t.innerHTML='<div class="journey-list"></div>';const n=t.querySelector(".journey-list");n&&e.forEach((e=>{const t=document.createElement("div");t.className="journey-card";const s=e.email||"Non renseign√©",o=e.source||"direct";t.innerHTML=`\n                    <div class="journey-header">\n                        <div>\n                            <h3>üìß ${s}</h3>\n                            <p>Source: ${o}</p>\n                        </div>\n                        <span class="source">${o}</span>\n                    </div>\n                    <div class="steps" id="steps-${e.sessionId}"></div>\n                `,n.appendChild(t);const a=t.querySelector(`#steps-${e.sessionId}`);a&&e.steps.forEach(((e,t)=>{const n=document.createElement("div");n.className="step";const s=getIconForStep(e.action),o=getTitleForStep(e),i=formatTime(e.timestamp);n.innerHTML=`\n                            <span class="step-icon">${s}</span>\n                            <div class="step-details">\n                                <div class="step-title">${o}</div>\n                                <div class="step-time">${i}</div>\n                            </div>\n                        `,a.appendChild(n)}))}))}function getIconForStep(e){return{visit:"üåê",cta_click:"üëÜ",optin:"‚úÖ",purchase:"üí∞",scroll_depth:"üìú",time_on_page:"‚è±Ô∏è"}[e]||"üìå"}function getTitleForStep(e){return{visit:`Visite sur ${e.page||""}`,cta_click:`Clic sur ${e.element||"CTA"}`,optin:`Opt-in : ${e.email||"Inscription"}`,purchase:`Achat : ${e.amount||497}‚Ç¨`,scroll_depth:`Scroll : ${e.percent||0}%`,time_on_page:`Temps sur page : ${e.seconds||0}s`}[e.action]||e.action}function formatTime(e){const t=new Date(e),n=new Date,s=Number(n)-Number(t),o=Math.floor(s/1e3),a=Math.floor(o/60),i=Math.floor(a/60),c=Math.floor(i/24);return c>0?`Il y a ${c} jour${c>1?"s":""}`:i>0?`Il y a ${i}h${a>0?a:""}`:a>0?`Il y a ${a}min`:"√Ä l'instant"}async function loadGoogleAnalytics(){try{const e=await fetch("/api/google-analytics"),t=await e.json();if(document.getElementById("ga-today")&&(document.getElementById("ga-today").textContent=t.traffic.today),document.getElementById("ga-conversion")&&(document.getElementById("ga-conversion").textContent=t.performance.conversionRate+"%"),document.getElementById("ga-duration")){const e=Math.floor(t.performance.avgSessionDuration/60);document.getElementById("ga-duration").textContent=e+"min"}document.getElementById("ga-realtime")&&(document.getElementById("ga-realtime").textContent=t.realTime.activeUsers),displayTrafficSources(t.traffic.sources)}catch(e){console.log("Erreur chargement GA:",e)}}function displayTrafficSources(e){const t=document.getElementById("sources-container");t&&(t.innerHTML="",e.forEach((e=>{const n=document.createElement("div");n.className="source-card";const s=e.visits>0?Math.round(e.conversions/e.visits*100):0;n.innerHTML=`\n                    <div class="source-name">${e.name}</div>\n                    <div class="source-grid">\n                        <div class="source-stat">\n                            <div class="source-stat-label">Visites</div>\n                            <div class="source-stat-value">${e.visits}</div>\n                        </div>\n                        <div class="source-stat">\n                            <div class="source-stat-label">Conversions</div>\n                            <div class="source-stat-value">${e.conversions}</div>\n                            <div class="source-stat-rate">${s}%</div>\n                        </div>\n                        <div class="source-stat">\n                            <div class="source-stat-label">Revenus</div>\n                            <div class="source-stat-revenue">${e.revenue}‚Ç¨</div>\n                        </div>\n                    </div>\n                `,t.appendChild(n)})))}loadJourneys(),loadGoogleAnalytics(),setInterval(loadJourneys,3e4),setInterval(loadGoogleAnalytics,3e4)</script></body></html>