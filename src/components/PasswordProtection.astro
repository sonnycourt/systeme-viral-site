---
// Composant de protection par mot de passe basé sur localStorage
// Mot de passe par défaut (à changer si nécessaire)
const DEFAULT_PASSWORD = "systemeviral2025";
---

<div id="password-protection" class="password-protection hidden">
	<div class="password-overlay">
		<div class="password-modal">
			<h2 class="password-title">Accès Protégé</h2>
			<p class="password-subtitle">Veuillez entrer le mot de passe pour accéder au site</p>
			
			<form id="password-form" class="password-form">
				<input
					type="password"
					id="password-input"
					class="password-input"
					placeholder="Mot de passe"
					autocomplete="off"
					autofocus
				/>
				<button type="submit" class="password-submit">Accéder</button>
			</form>
			
			<div id="password-error" class="password-error hidden">
				Mot de passe incorrect
			</div>
		</div>
	</div>
</div>

<script>
	(function() {
		const STORAGE_KEY = 'sv_password_authenticated';
		const DEFAULT_PASSWORD = 'systemeviral2025';
		
		// Vérifier si l'utilisateur est déjà authentifié
		function isAuthenticated() {
			const authStatus = localStorage.getItem(STORAGE_KEY);
			if (!authStatus) return false;
			
			// Vérifier que la date n'est pas trop ancienne (optionnel, pour sécurité basique)
			try {
				const authData = JSON.parse(authStatus);
				const now = Date.now();
				// Le mot de passe reste valide pendant 24h (optionnel)
				if (authData.expires && authData.expires < now) {
					localStorage.removeItem(STORAGE_KEY);
					return false;
				}
				return true;
			} catch (e) {
				return false;
			}
		}
		
		// Sauvegarder l'authentification
		function saveAuthentication() {
			const authData = {
				authenticated: true,
				timestamp: Date.now(),
				// Expire dans 24h (optionnel)
				expires: Date.now() + (24 * 60 * 60 * 1000)
			};
			localStorage.setItem(STORAGE_KEY, JSON.stringify(authData));
		}
		
		// Afficher le formulaire de mot de passe
		function showPasswordForm() {
			const protection = document.getElementById('password-protection');
			const mainContent = document.querySelector('main');
			if (protection) {
				protection.classList.remove('hidden');
				if (mainContent) {
					mainContent.style.display = 'none';
				}
			}
		}
		
		// Masquer le formulaire et afficher le contenu
		function hidePasswordForm() {
			const protection = document.getElementById('password-protection');
			const mainContent = document.querySelector('main');
			if (protection) {
				protection.classList.add('hidden');
				if (mainContent) {
					mainContent.style.display = '';
				}
			}
		}
		
		// Gérer la soumission du formulaire
		function handlePasswordSubmit(e: Event) {
			e.preventDefault();
			const input = document.getElementById('password-input') as HTMLInputElement | null;
			const error = document.getElementById('password-error');
			const password = input?.value;
			
			if (password === DEFAULT_PASSWORD) {
				saveAuthentication();
				hidePasswordForm();
				if (error) error.classList.add('hidden');
			} else {
				if (error) error.classList.remove('hidden');
				if (input) {
					input.value = '';
					input.focus();
				}
			}
		}
		
		// Initialisation
		document.addEventListener('DOMContentLoaded', function() {
			const form = document.getElementById('password-form');
			if (form) {
				form.addEventListener('submit', handlePasswordSubmit);
			}
			
			if (!isAuthenticated()) {
				showPasswordForm();
			} else {
				hidePasswordForm();
			}
		});
	})();
</script>

<style>
	.password-protection {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		z-index: 999999;
		background: rgba(0, 0, 0, 0.95);
		backdrop-filter: blur(10px);
	}
	
	.password-protection.hidden {
		display: none;
	}
	
	.password-overlay {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100%;
		padding: 20px;
	}
	
	.password-modal {
		background: #1a1a1a;
		border: 1px solid #333;
		border-radius: 12px;
		padding: 40px;
		max-width: 400px;
		width: 100%;
		box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
	}
	
	.password-title {
		color: #ffffff;
		font-size: 24px;
		font-weight: 700;
		margin: 0 0 8px 0;
		text-align: center;
	}
	
	.password-subtitle {
		color: rgba(255, 255, 255, 0.7);
		font-size: 14px;
		margin: 0 0 24px 0;
		text-align: center;
	}
	
	.password-form {
		display: flex;
		flex-direction: column;
		gap: 16px;
	}
	
	.password-input {
		width: 100%;
		padding: 14px 16px;
		background: #2a2a2a;
		border: 1px solid #444;
		border-radius: 8px;
		color: #ffffff;
		font-size: 16px;
		outline: none;
		transition: border-color 0.2s;
		box-sizing: border-box;
	}
	
	.password-input:focus {
		border-color: #00dc82;
	}
	
	.password-input::placeholder {
		color: rgba(255, 255, 255, 0.4);
	}
	
	.password-submit {
		width: 100%;
		padding: 14px;
		background: #00dc82;
		border: none;
		border-radius: 8px;
		color: #000000;
		font-size: 16px;
		font-weight: 600;
		cursor: pointer;
		transition: background 0.2s;
	}
	
	.password-submit:hover {
		background: #00c471;
	}
	
	.password-submit:active {
		transform: scale(0.98);
	}
	
	.password-error {
		margin-top: 12px;
		padding: 12px;
		background: rgba(255, 0, 0, 0.1);
		border: 1px solid rgba(255, 0, 0, 0.3);
		border-radius: 6px;
		color: #ff4444;
		font-size: 14px;
		text-align: center;
	}
	
	.password-error.hidden {
		display: none;
	}
</style>